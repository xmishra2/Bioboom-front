<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BioBoom GM</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    input, textarea, button, select { display: block; width: 100%; margin: 10px 0; padding: 10px; }
    h2 { margin-top: 2rem; }
    pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <script>
    const role = sessionStorage.getItem('role');
    const pin = sessionStorage.getItem('pin');
    if (role !== 'gm' || !pin) {
      alert("Access denied. Please login as Game Master.");
      window.location.href = "login.html";
    }
  </script>

  <h2>🧠 Game Master Dashboard</h2>

  <button onclick="generatePin()">🔁 Generate New Player PIN</button>
  <p id="pinDisplay"></p>

  <h2>🎲 Set Scenario & Policy</h2>
  <label for="scenarioSelect">Choose Scenario:</label>
  <select id="scenarioSelect">
    <option value="Recession">Recession</option>
    <option value="Boom">Boom</option>
    <option value="Tech Breakthrough">Tech Breakthrough</option>
    <option value="Policy Shift">Policy Shift</option>
    <option value="Carbon Tax">Carbon Tax</option>
  </select>

  <label for="policyNote">Tip for Players (Policy Note):</label>
  <textarea id="policyNote" placeholder="e.g., Focus on TRL upgrades or reduce externalities..."></textarea>
  <button onclick="setScenario()">🚀 Launch Scenario</button>

  <h2>📊 Submissions</h2>
  <button onclick="loadSubmissions()">🔄 Refresh Submissions</button>
  <pre id="submissionsBox">Waiting for player inputs...</pre>

  <script>
    const API = 'https://bioboomserver.onrender.com';

    function generatePin() {
      fetch(`${API}/generate-pin`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          document.getElementById('pinDisplay').innerText =
            `✅ New PIN: ${data.pin} (valid till ${new Date(data.expires).toLocaleString()})`;
        });
    }

    function setScenario() {
      const scenario = document.getElementById('scenarioSelect').value;
      const policyNote = document.getElementById('policyNote').value;
      fetch(`${API}/scenario`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ scenario, policyNote })
      }).then(() => alert("✅ Scenario set for this round!"));
    }

    function loadSubmissions() {
      fetch(`${API}/submissions`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('submissionsBox').innerText =
            JSON.stringify(data, null, 2);
        });
    }
  </script>
</body>
</html>
